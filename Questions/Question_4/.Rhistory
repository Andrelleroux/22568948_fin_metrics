View(BM_Holds)
View(BM_Rets)
View(Port_Holds)
View(Port_Rets)
library(rportfolios)
?rportfolios
Port_Rets <- read_rds("data/Fund_Rets.rds")
BM_Rets <- read_rds("data/BM_Rets.rds")
Plot_1 <- left_join(BM_Rets, Port_Rets %>% select(-Portolio), by = date)
Plot_1 <- left_join(BM_Rets, Port_Rets %>% select(-Portolio), by = "date")
View(Plot_1)
Tracking_Error_df <- left_join(BM_Rets, Port_Rets %>% select(-Portolio), by = "date") %>%
mutate(Diff = Returns - BM) %>%
Track_Error <- sd(Tracking_Error_df$Diff)
Tracking_Error_df <- left_join(BM_Rets, Port_Rets %>% select(-Portolio), by = "date") %>%
mutate(Diff = Returns - BM)
Track_Error <- sd(Tracking_Error_df$Diff)
Tracking_Error_df <- left_join(BM_Rets, Port_Rets %>% select(-Portolio), by = "date") %>%
mutate(Diff = Returns - BM)
Track_Error <- round(sd(Tracking_Error_df$Diff),4)*100
Tracking_Error_df <- left_join(BM_Rets, Port_Rets %>% select(-Portolio), by = "date") %>%
mutate(Diff = Returns - BM)
Track_Error <- round(sd(Tracking_Error_df$Diff),5)*100
library(PerformanceAnalytics)
tabDownside <- table.DownsideRisk(Port_Rets %>% tbl_xts(.), ci = 0.95, Rf=0, MAR=0)
library(tbl2xts)
tabDownside <- table.DownsideRisk(Port_Rets %>% tbl_xts(.), ci = 0.95, Rf=0, MAR=0)
View(tabDownside)
tabDownside <- table.DownsideRisk(Port_Rets %>% tbl_xts(.), ci = 0.95, Rf=0, MAR=0)
tabdownside <- tabdownside[c(1,3,5,7,8:11),]
tabDownside <- table.DownsideRisk(Port_Rets %>% tbl_xts(.), ci = 0.95, Rf=0, MAR=0)
tabDownside <- tabdownside[c(1,3,5,7,8:11),]
tabDownside <- table.DownsideRisk(Port_Rets %>% tbl_xts(.), ci = 0.95, Rf=0, MAR=0)
tabDownside <- tabDownside[c(1,3,5,7,8:11),]
tabDownside %>% data.frame() %>% tibble::rownames_to_column() %>%
gt() %>%
tab_header(title = glue::glue("Downside Risk estimates")) %>%
fmt_percent(
columns = 2:3,
decimals = 2
)
install.packages("fmt_percent")
tabDownside <- table.DownsideRisk(Port_Rets %>% tbl_xts(.), ci = 0.95, Rf=0, MAR=0)
tabDownside <- tabDownside[c(1,3,5,7,8:11),]
tabDownside %>% data.frame() %>% tibble::rownames_to_column() %>%
gt() %>%
tab_header(title = glue::glue("Downside Risk estimates"))
library(gt)
library(gt)
tabDownside <- table.DownsideRisk(Port_Rets %>% tbl_xts(.), ci = 0.95, Rf=0, MAR=0)
tabDownside <- tabDownside[c(1,3,5,7,8:11),]
tabDownside %>% data.frame() %>% tibble::rownames_to_column() %>%
gt() %>%
tab_header(title = glue::glue("Downside Risk estimates")) %>%
fmt_percent(
columns = 2:3,
decimals = 2
)
tabDownside <- table.DownsideRisk(Port_Rets %>% tbl_xts(.), ci = 0.95, Rf=0, MAR=0)
tabDownside <- tabDownside[c(1,3,5,7,8:11),]
tabDownside %>% data.frame() %>% tibble::rownames_to_column() %>%
gt() %>%
tab_header(title = glue::glue("Downside Risk estimates")) %>%
fmt_percent(
columns = 2,
decimals = 2
)
tabDownside <- table.DownsideRisk(Port_Rets %>% tbl_xts(.), ci = 0.95, Rf=0, MAR=0)
tabDownside <- tabDownside[c(1,3,5,7,8:11),]
tabDownside
tabDownside %>% data.frame() %>% tibble::rownames_to_column() %>%
gt() %>%
tab_header(title = glue::glue("Downside Risk estimates")) %>%
fmt_percent(
columns = 2,
decimals = 2
)
tabDownside <- table.DownsideRisk(Port_Rets %>% tbl_xts(.), ci = 0.95, Rf=0, MAR=0)
View(tabDownside)
tabDownside <- table.DownsideRisk(Port_Rets %>% tbl_xts(.), ci = 0.95, Rf=0, MAR=0)
tabDownside <- tabDownside[c(1,3,5,7,8:11),]
row_names <- c("Semi Deviation", "")
tabDownside %>% data.frame() %>%
gt() %>%
tab_header(title = glue::glue("Downside Risk estimates")) %>%
fmt_percent(
columns = 2,
decimals = 2
)
tabDownside <- table.DownsideRisk(Port_Rets %>% tbl_xts(.), ci = 0.95, Rf=0, MAR=0)
View(tabDownside)
tabDownside <- tabDownside[c(1,3,5,7:9),] %>% rbind(Track_Error)
View(tabDownside)
tabDownside <- tabDownside[c(1,3,5,7:9),] %>% cbind(Track_Error)
tabDownside <- table.DownsideRisk(Port_Rets %>% tbl_xts(.), ci = 0.95, Rf=0, MAR=0)
tabDownside <- tabDownside[c(1,3,5,7:9),]
tabDownside <- table.DownsideRisk(Port_Rets %>% tbl_xts(.), ci = 0.95, Rf=0, MAR=0)
tabDownside <- tabDownside[c(1,3,5,7:9),]
row_names <- c("Semi Deviation", "Loss Deviation", "Downside Deviation (Rf = 0%)",
"Maximum Drawdown", "Historical VaR (95%)", "Historical ES (95%)")
tabDownside %>% data.frame() %>% rbind(Track_Error) %>% tibble::rownames_to_column() %>%
gt() %>%
tab_header(title = glue::glue("Downside Risk estimates")) %>%
fmt_percent(
columns = 2,
decimals = 2
)
tabDownside <- table.DownsideRisk(Port_Rets %>% tbl_xts(.), ci = 0.95, Rf=0, MAR=0)
tabDownside <- tabDownside[c(1,3,5,7:9),]
row_names <- c("Semi Deviation", "Loss Deviation", "Downside Deviation (Rf = 0%)",
"Maximum Drawdown", "Historical VaR (95%)", "Historical ES (95%)")
tabDownside %>% data.frame() %>% rbind(Track_Error) %>% tibble::rownames_to_column() %>%
gt() %>%
tab_header(title = glue::glue("Downside Risk estimates")) %>%
fmt_percent(
columns = 2,
decimals = 2
)
Track_Error <- round(sd(Tracking_Error_df$Diff),6)
tabDownside <- table.DownsideRisk(Port_Rets %>% tbl_xts(.), ci = 0.95, Rf=0, MAR=0)
tabDownside <- tabDownside[c(1,3,5,7:9),]
row_names <- c("Semi Deviation", "Loss Deviation", "Downside Deviation (Rf = 0%)",
"Maximum Drawdown", "Historical VaR (95%)", "Historical ES (95%)")
tabDownside %>% data.frame() %>% rbind(Track_Error) %>% tibble::rownames_to_column() %>%
gt() %>%
tab_header(title = glue::glue("Downside Risk estimates")) %>%
fmt_percent(
columns = 2,
decimals = 2
)
tabDownside <- table.DownsideRisk(Port_Rets %>% tbl_xts(.), ci = 0.95, Rf=0, MAR=0)
tabDownside <- tabDownside[c(1,3,5,7:9),]
row_names <- c("Semi Deviation", "Loss Deviation", "Downside Deviation (Rf = 0%)",
"Maximum Drawdown", "Historical VaR (95%)", "Historical ES (95%)",
"Tracking Error to Benchmark")
tabDownside %>% data.frame() %>% rbind(Track_Error) %>% tibble::rownames_to_column() %>%
gt() %>%
tab_header(title = glue::glue("Downside Risk estimates")) %>%
fmt_percent(
columns = 2,
decimals = 2
)
%>% tab_row_labels(row_labels = row_names)
tabDownside <- table.DownsideRisk(Port_Rets %>% tbl_xts(.), ci = 0.95, Rf=0, MAR=0)
tabDownside <- tabDownside[c(1,3,5,7:9),]
row_names <- c("Semi Deviation", "Loss Deviation", "Downside Deviation (Rf = 0%)",
"Maximum Drawdown", "Historical VaR (95%)", "Historical ES (95%)",
"Tracking Error to Benchmark")
tabDownside %>% data.frame() %>% rbind(Track_Error) %>% tibble::rownames_to_column() %>%
gt() %>%
tab_header(title = glue::glue("Downside Risk estimates")) %>%
fmt_percent(
columns = 2,
decimals = 2
) %>% tab_row_labels(row_labels = row_names)
tabDownside <- table.DownsideRisk(Port_Rets %>% tbl_xts(.), ci = 0.95, Rf=0, MAR=0)
tabDownside <- tabDownside[c(1,3,5,7:9),]
row_names <- c("Semi Deviation", "Loss Deviation", "Downside Deviation (Rf = 0%)",
"Maximum Drawdown", "Historical VaR (95%)", "Historical ES (95%)",
"Tracking Error to Benchmark")
tabDownside %>% data.frame() %>% rbind(Track_Error) %>% cbind(row_names) %>%
tibble::rownames_to_column() %>%
gt() %>%
tab_header(title = glue::glue("Downside Risk estimates")) %>%
fmt_percent(
columns = 2,
decimals = 2
) %>% tab_row_labels(row_labels = row_names)
tabDownside <- table.DownsideRisk(Port_Rets %>% tbl_xts(.), ci = 0.95, Rf=0, MAR=0)
tabDownside <- tabDownside[c(1,3,5,7:9),]
row_names <- c("Semi Deviation", "Loss Deviation", "Downside Deviation (Rf = 0%)",
"Maximum Drawdown", "Historical VaR (95%)", "Historical ES (95%)",
"Tracking Error to Benchmark")
tabDownside %>% data.frame() %>% rbind(Track_Error) %>% cbind(row_names) %>%
tibble::rownames_to_column() %>%
gt() %>%
tab_header(title = glue::glue("Downside Risk estimates")) %>%
fmt_percent(
columns = 2,
decimals = 2
)
tabDownside <- table.DownsideRisk(Port_Rets %>% tbl_xts(.), ci = 0.95, Rf=0, MAR=0)
tabDownside <- tabDownside[c(1,3,5,7:9),]
Measures <- c("Semi Deviation", "Loss Deviation", "Downside Deviation (Rf = 0%)",
"Maximum Drawdown", "Historical VaR (95%)", "Historical ES (95%)",
"Tracking Error to Benchmark")
tabDownside %>% data.frame() %>% rbind(Track_Error) %>% cbind(Measures) %>%
tibble::rownames_to_column() %>%
gt() %>%
tab_header(title = glue::glue("Downside Risk estimates")) %>%
fmt_percent(
columns = 2,
decimals = 2
)
tabDownside <- table.DownsideRisk(Port_Rets %>% tbl_xts(.), ci = 0.95, Rf=0, MAR=0)
tabDownside <- tabDownside[c(1,3,5,7:9),]
Measures <- c("Semi Deviation", "Loss Deviation", "Downside Deviation (Rf = 0%)",
"Maximum Drawdown", "Historical VaR (95%)", "Historical ES (95%)",
"Tracking Error to Benchmark")
tabDownside %>% data.frame() %>% rbind(Track_Error) %>% cbind(Measures) %>%
tibble::rownames_to_column() %>%
gt() %>%
cols_move_to_start(Measures) %>%
tab_header(title = glue::glue("Downside Risk estimates")) %>%
fmt_percent(
columns = 2,
decimals = 2
)
tabDownside %>% data.frame()
tabDownside <- table.DownsideRisk(Port_Rets %>% tbl_xts(.), ci = 0.95, Rf=0, MAR=0)
tabDownside <- tabDownside[c(1,3,5,7:9),]
Measures <- c("Semi Deviation", "Loss Deviation", "Downside Deviation (Rf = 0%)",
"Maximum Drawdown", "Historical VaR (95%)", "Historical ES (95%)",
"Tracking Error to Benchmark")
tabDownside %>% data.frame() %>% rbind(Track_Error) %>% cbind(Measures) %>%
tibble::rownames_to_column() %>%
gt() %>%
cols_move_to_start(Measures) %>%
cols_label(. = "SnakeOil Fund")
tabDownside <- table.DownsideRisk(Port_Rets %>% tbl_xts(.), ci = 0.95, Rf=0, MAR=0)
tabDownside <- tabDownside[c(1,3,5,7:9),]
Measures <- c("Semi Deviation", "Loss Deviation", "Downside Deviation (Rf = 0%)",
"Maximum Drawdown", "Historical VaR (95%)", "Historical ES (95%)",
"Tracking Error to Benchmark")
tabDownside %>% data.frame() %>% rbind(Track_Error) %>% cbind(Measures) %>%
tibble::rownames_to_column() %>%
gt() %>%
cols_move_to_start(Measures) %>%
cols_label(. = "SnakeOil Fund") %>%
tab_header(title = glue::glue("Downside Risk Estimates")) %>%
fmt_percent(
columns = 2,
decimals = 2
)
library(tidyverse)
Port_Holds <- read_rds("data/Fund Holds.rds")
Port_Holds <- read_rds("data/Fund_Holds.rds")
BM_Holds <- read_rds("data/BM_Holds.rds")
View(BM_Holds)
View(Port_Holds)
Combined <- left_join(Port_Holds, BM_Holds, by = "date", "Tickers")
Combined <- left_join(Port_Holds, BM_Holds, by = "date")
Port_Holds <- read_rds("data/Fund_Holds.rds")
BM_Holds <- read_rds("data/BM_Holds.rds") %>% select(Tickers, Sector)
Combined <- left_join(Port_Holds, BM_Holds, by = "Tickers")
Combined <- left_join(BM_Holds, Port_Holds, by = "Tickers")
View(BM_Holds)
BM_Holds <- read_rds("data/BM_Holds.rds") %>% select(Tickers, Sector) %>%
unique()
View(BM_Holds)
Combined <- left_join(BM_Holds, Port_Holds, by = "Tickers")
Combined <- left_join(Port_Holds, BM_Holds, by = "Tickers")
Combined <- inner_join(Port_Holds, BM_Holds, by = "Tickers")
Combined <- outer_join(Port_Holds, BM_Holds, by = "Tickers")
Combined <- left_join(Port_Holds, BM_Holds, by = "Tickers", relationship = "many-to-many")
View(Combined)
Check = sum(is.na(Combined$Weight))
Combined <- left_join(Port_Holds, BM_Holds, by = "Tickers", relationship = "many-to-many") %>%
group_by(Sector, date) %>%
summarise(Weight)
Combined <- left_join(Port_Holds, BM_Holds, by = "Tickers", relationship = "many-to-many") %>%
group_by(Sector) %>%
summarise(Weight)
Combined <- left_join(Port_Holds, BM_Holds, by = "Tickers", relationship = "many-to-many")
Combined <- left_join(Port_Holds, BM_Holds, by = "Tickers", relationship = "many-to-many") %>%
group_by(Sector, Ticker) %>%
summarise(AverageWeight = mean(Weight), .groups = "drop")
Combined <- left_join(Port_Holds, BM_Holds, by = "Tickers", relationship = "many-to-many") %>%
group_by(Sector, Tickers) %>%
summarise(AverageWeight = mean(Weight), .groups = "drop")
Combined <- left_join(Port_Holds, BM_Holds, by = "Tickers", relationship = "many-to-many") %>%
group_by(Sector, Tickers) %>%
summarise(AverageWeight = mean(Weight), .groups = "drop") %>%
group_by(Sector) %>%
summarise(SumAverageWeight = sum(AverageWeight), .groups = "drop")
Combined <- left_join(Port_Holds, BM_Holds, by = "Tickers", relationship = "many-to-many") %>%
group_by(Sector, Date)
Combined <- left_join(Port_Holds, BM_Holds, by = "Tickers", relationship = "many-to-many")
Combined <- left_join(Port_Holds, BM_Holds, by = "Tickers", relationship = "many-to-many") %>%
group_by(Sector, date)
Combined <- left_join(Port_Holds, BM_Holds, by = "Tickers", relationship = "many-to-many") %>%
group_by(Sector, date) %>%
summarise(TotalWeight = sum(Weight), .groups = "drop")
Combined <- left_join(Port_Holds, BM_Holds, by = "Tickers", relationship = "many-to-many") %>%
group_by(Sector, date) %>%
summarise(TotalWeight = sum(Weight), .groups = "drop") %>%
group_by(date) %>%
mutate(PercentWeight = TotalWeight / sum(TotalWeight))
Plot_1 <- left_join(Port_Holds, BM_Holds, by = "Tickers", relationship = "many-to-many") %>%
group_by(Sector, date) %>%
summarise(TotalWeight = sum(Weight), .groups = "drop") %>%
group_by(date) %>%
mutate(PercentWeight = TotalWeight / sum(TotalWeight)) %>%
ggplot(aes(date, PercentWeight, fill = Sector)) +
geom_area(alpha = 0.7) +
scale_y_continuous(labels = scales::percent()) +
labs(
title = "Sector Breakdown Over Time",
x = "Date",
y = "Portfolio Share (%)",
fill = "Sector"
) +
fmxdat::theme_fmx()
Plot_1 <- left_join(Port_Holds, BM_Holds, by = "Tickers", relationship = "many-to-many") %>%
group_by(Sector, date) %>%
summarise(TotalWeight = sum(Weight), .groups = "drop") %>%
group_by(date) %>%
mutate(PercentWeight = TotalWeight / sum(TotalWeight)) %>%
ggplot(aes(date, PercentWeight, fill = Sector)) +
geom_area(alpha = 0.7) +
scale_y_continuous(labels = scales::percent) +
labs(
title = "Sector Breakdown Over Time",
x = "Date",
y = "Portfolio Share (%)",
fill = "Sector"
) +
fmxdat::theme_fmx()
Plot_1
Plot_2 <- Port_Holds %>% tbl_xts() %>% .[endpoints(.,'months')] %>% chart.StackedBar()
Plot_2 <- Port_Holds %>% tbl_xts()
View(Plot_2)
Plot_2 <- Port_Holds %>% tbl_xts(., cols_to_xts = Weight, spread_by = Type) %>%
.[endpoints(.,'months')] %>% chart.StackedBar()
Plot_2 <- Port_Holds %>% tbl_xts(., cols_to_xts = Weight, spread_by = Type)
Plot_2 <- Port_Holds %>% tbl_xts(., cols_to_xts = Weight, spread_by = Tickers)
View(Plot_2)
Plot_2 <- Port_Holds %>% tbl_xts(., cols_to_xts = Weight, spread_by = Tickers) %>%
.[endpoints(.,'months')] %>% chart.StackedBar()
Plot_2 <- Port_Holds %>% tbl_xts(., cols_to_xts = Weight, spread_by = Tickers)
Plot_2[is.na(Plot_2)] <- 0
Plot_2 <- Port_Holds %>% tbl_xts(., cols_to_xts = Weight, spread_by = Tickers)
Plot_2[is.na(Plot_2)] <- 0
Plot_2 <- Plot_2 %>% .[endpoints(.,'months')] %>% chart.StackedBar()
Plot_2 <- Port_Holds %>% tbl_xts(., cols_to_xts = Weight, spread_by = Tickers)
Plot_2[is.na(Plot_2)] <- 0
Plot_2 <- Plot_2 %>% .[endpoints(.,'months')] %>% chart.StackedBar() + labs(title = "2")
Plot_2 <- Port_Holds %>% tbl_xts(., cols_to_xts = Weight, spread_by = Tickers)
Plot_2[is.na(Plot_2)] <- 0
Plot_2 <- Plot_2 %>% .[endpoints(.,'months')] %>% chart.StackedBar(main = "Stacked Bar Chart of Rand BP Weight",
ylab = "Weight (%)",
xlab = "Date")
Plot_2 <- Port_Holds %>% tbl_xts(., cols_to_xts = Weight, spread_by = Tickers)
Plot_2[is.na(Plot_2)] <- 0
Plot_2 <- Plot_2 %>% .[endpoints(.,'months')] %>% as.data.frame() %>%
tibble::rownames_to_column("Date") %>%
pivot_longer(-Date, names_to = "Category", values_to = "Weight") %>%
ggplot(aes(x = Date, y = Weight, fill = Category)) +
geom_bar(stat = "identity") +
scale_fill_manual(values = c("blue", "red", "green", "orange", "purple")) +
labs(
title = "Stacked Bar Chart of Rand BP Weight",
x = "Date",
y = "Weight (%)"
) +
theme_minimal() +
theme(axis.text.x = element_text(angle = 45, hjust = 1))
Plot_2
Plot_2 <- Plot_2 %>% .[endpoints(.,'months')] %>% as.data.frame() %>%
tibble::rownames_to_column("Date") %>%
pivot_longer(-Date, names_to = "Category", values_to = "Weight") %>%
ggplot(aes(x = Date, y = Weight, fill = Category)) +
geom_bar(stat = "identity") +
labs(
title = "Stacked Bar Chart of Rand BP Weight",
x = "Date",
y = "Weight (%)"
) +
theme_minimal() +
theme(axis.text.x = element_text(angle = 45, hjust = 1))
Plot_2 <- Plot_2 %>% .[endpoints(.,'months')] %>% chart.StackedBar(main = "Stacked Bar Chart of Stock Weights",
ylab = "Weight (%)",
xlab = "Date")
Plot_2 <- Port_Holds %>% tbl_xts(., cols_to_xts = Weight, spread_by = Tickers)
Plot_2[is.na(Plot_2)] <- 0
Plot_2 <- Plot_2 %>% .[endpoints(.,'months')] %>% chart.StackedBar(main = "Stacked Bar Chart of Stock Weights",
ylab = "Weight (%)",
xlab = "Date")
View(BM_Holds)
View(BM_Rets)
View(Port_Rets)
library(tidyverse)
library(tbl2xts)
library(PerformanceAnalytics)
Port_Holds <- read_rds("data/Fund_Holds.rds")
Plot_2 <- Port_Holds %>% tbl_xts(., cols_to_xts = Weight, spread_by = Tickers)
Plot_2[is.na(Plot_2)] <- 0
Plot_2 <- Plot_2 %>% xts_tbl()
View(Plot_2)
Plot_2 <- Port_Holds %>% tbl_xts(., cols_to_xts = Weight, spread_by = Tickers)
Plot_2[is.na(Plot_2)] <- 0
Plot_2 <- Plot_2 %>% xts_tbl() %>% gather(Tickers, Returns, -date)
Plot_2 <- Port_Holds %>% tbl_xts(., cols_to_xts = Weight, spread_by = Tickers)
#Make all NA values 0 as no weights at that point
Plot_2[is.na(Plot_2)] <- 0
#Gather again and get Top 8 most prevalent stocks
Plot_2 <- Plot_2 %>% xts_tbl() %>%
gather(Tickers, Returns, -date) %>%
group_by(Tickers) %>%
summarise(Avg_Weight = mean(Weight, na.rm = T)) %>%
arrange(desc(Avg_Weight))
Plot_2 <- Port_Holds %>% tbl_xts(., cols_to_xts = Weight, spread_by = Tickers)
#Make all NA values 0 as no weights at that point
Plot_2[is.na(Plot_2)] <- 0
#Gather again and get Top 8 most prevalent stocks
Plot_2 <- Plot_2 %>% xts_tbl() %>%
gather(Tickers, Weight, -date) %>%
group_by(Tickers) %>%
summarise(Avg_Weight = mean(Weight, na.rm = T)) %>%
arrange(desc(Avg_Weight))
Plot_2 <- Plot_2 %>% xts_tbl() %>%
gather(Tickers, Weight, -date) %>%
group_by(Tickers) %>%
summarise(Avg_Weight = mean(Weight, na.rm = T)) %>%
arrange(desc(Avg_Weight)) %>%
slice_head(8) %>%
pull(Tickers)
Plot_2 <- Port_Holds %>% tbl_xts(., cols_to_xts = Weight, spread_by = Tickers)
#Make all NA values 0 as no weights at that point
Plot_2[is.na(Plot_2)] <- 0
#Gather again and get Top 8 most prevalent stocks
Plot_2 <- Plot_2 %>% xts_tbl() %>%
gather(Tickers, Weight, -date) %>%
group_by(Tickers) %>%
summarise(Avg_Weight = mean(Weight, na.rm = T)) %>%
arrange(desc(Avg_Weight)) %>%
slice_head(n = 8) %>%
pull(Tickers)
Weight_xts <- Port_Holds %>% tbl_xts(., cols_to_xts = Weight, spread_by = Tickers)
#Make all NA values 0 as no weights at that point
Weight_xts[is.na(Weight_xts)] <- 0
#Gather again and get Top 8 most prevalent stocks
Top_Weights <- Weight_xts %>% xts_tbl() %>%
gather(Tickers, Weight, -date) %>%
group_by(Tickers) %>%
summarise(Avg_Weight = mean(Weight, na.rm = T)) %>%
arrange(desc(Avg_Weight)) %>%
slice_head(n = 8) %>%
pull(Tickers)
Plot_2 <- Weight_xts %>% xts_tbl() %>%
gather(Tickers, Weight, -date) %>%
mutate(Tickers = if_else(Tickers %in% Top_Weights, Tickers, "Other"))
Plot_2 <- Weight_xts %>% xts_tbl() %>%
gather(Tickers, Weight, -date) %>%
mutate(Tickers = if_else(Tickers %in% Top_Weights, Tickers, "Other")) %>%
tbl_xts(., cols_to_xts = Weight, spread_by = Tickers) %>%
.[endpoints(.,'months')] %>% chart.StackedBar(main = "Stacked Bar Chart of Stock Weights",
ylab = "Weight (%)",
xlab = "Date")
Plot_2 <- Weight_xts %>% xts_tbl() %>%
gather(Tickers, Weight, -date) %>%
mutate(Tickers = if_else(Tickers %in% Top_Weights, Tickers, "Other")) %>%
tbl_xts(., cols_to_xts = Weight, spread_by = Tickers)
Plot_2 <- Weight_xts %>% xts_tbl() %>%
gather(Tickers, Weight, -date) %>%
mutate(Tickers = if_else(Tickers %in% Top_Weights, Tickers, "Other")) %>%
group_by(date, Tickers) %>%
summarise(Weight = sum(Weight, na.rm = T)) %>%
tbl_xts(., cols_to_xts = Weight, spread_by = Tickers) %>%
.[endpoints(.,'months')] %>% chart.StackedBar(main = "Stacked Bar Chart of Stock Weights",
ylab = "Weight (%)",
xlab = "Date")
install.packages("RColorBrewer")
library(RColorBrewer)
Plot_2 <- Weight_xts %>% xts_tbl() %>%
gather(Tickers, Weight, -date) %>%
mutate(Tickers = if_else(Tickers %in% Top_Weights, Tickers, "Other")) %>%
group_by(date, Tickers) %>%
summarise(Weight = sum(Weight, na.rm = T)) %>%
tbl_xts(., cols_to_xts = Weight, spread_by = Tickers) %>%
.[endpoints(.,'months')] %>% chart.StackedBar(main = "Stacked Bar Chart of Stock Weights",
ylab = "Weight (%)",
xlab = "Date",
col = c(brewer.pal(8, "Set3"), "grey"))
Top_Weights <- Weight_xts %>% xts_tbl() %>%
gather(Tickers, Weight, -date) %>%
group_by(Tickers) %>%
summarise(Avg_Weight = mean(Weight, na.rm = T)) %>%
arrange(desc(Avg_Weight)) %>%
slice_head(n = 10) %>%
pull(Tickers)
#Create Other stock consisting of stocks not in Top
Plot_2 <- Weight_xts %>% xts_tbl() %>%
gather(Tickers, Weight, -date) %>%
mutate(Tickers = if_else(Tickers %in% Top_Weights, Tickers, "Other")) %>%
group_by(date, Tickers) %>%
summarise(Weight = sum(Weight, na.rm = T)) %>%
tbl_xts(., cols_to_xts = Weight, spread_by = Tickers) %>%
.[endpoints(.,'months')] %>% chart.StackedBar(main = "Stacked Bar Chart of Stock Weights",
ylab = "Weight (%)",
xlab = "Date",
col = c(brewer.pal(10, "Set3"), "grey"))
Plot_2 <- Weight_xts %>% xts_tbl() %>%
gather(Tickers, Weight, -date) %>%
mutate(Tickers = if_else(Tickers %in% Top_Weights, Tickers, "Other")) %>%
group_by(date, Tickers) %>%
summarise(Weight = sum(Weight, na.rm = T)) %>%
tbl_xts(., cols_to_xts = Weight, spread_by = Tickers) %>%
.[endpoints(.,'months')] %>% chart.StackedBar(main = "Stacked Bar Chart of Stock Weights",
ylab = "Weight (%)",
xlab = "Date",
col = c(brewer.pal(10, "Set3"), "forestgreen"))
Plot_2 <- Weight_xts %>% xts_tbl() %>%
gather(Tickers, Weight, -date) %>%
mutate(Tickers = if_else(Tickers %in% Top_Weights, Tickers, "Other")) %>%
group_by(date, Tickers) %>%
summarise(Weight = sum(Weight, na.rm = T)) %>%
tbl_xts(., cols_to_xts = Weight, spread_by = Tickers) %>%
.[endpoints(.,'months')] %>% chart.StackedBar(main = "Stacked Bar Chart of Stock Weights",
ylab = "Weight (%)",
xlab = "Date",
col = c(brewer.pal(11, "Set3")))
